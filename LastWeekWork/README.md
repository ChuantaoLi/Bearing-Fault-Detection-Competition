# 多模态数据增强的轴承故障检测

## 思路问题

这个版本的数据增强思路是：

- 设计特征融合层，将频谱和包络特征输入网络进行融合，然后再分别生成新的频谱特征样本和包络特征样本

- 事先划分5折数据集，防止数据泄露，对每一折的训练集都进行了数据增强，每一折的验证集都不参与增强

- 目标合成样本数量为最大样本数量，对每个少数类都进行，在每一折的训练集中进行

---

存在的重大的问题：

- 由于预测部分的代码中，调优里面是自动划分5折交叉验证的，并且有多个强耦合的集成和预测等模块，不方便拆开修改

- 为了防止验证集也出现了合成的样本，所以在合成的时候是先划分了5折数据集，这将和后面的代码冲突

- 昨天参考的训练代码错了，只看Bearing_Fault_Diagnosis251027文件夹下的代码

## 代码解析

train_optimized_features.py中用到的pkl是optimized_features_dataset.pkl，其只加载了里面的训练数据：

- dataset['x_train']['spec']: 训练集频谱特征。

- dataset['x_train']['env']: 训练集包络特征。

- dataset['x_train']['time_stats']: 训练集时域统计特征。

- dataset['y_train']: 训练集标签。

同样是5折交叉验证，会导出会保存3个类别、共15个最佳模型：

- 脚本会找到平均准确率最高的那个试验（Trial），然后保存该试验训练出的全部5个折（Fold）的模型

- 脚本会找出平均准确率排名前5的试验

- 无视试验（Trial）来源，在所有试验产生的所有折（100*5=500个）中，选出验证集准确率全局最高的5个模型

test_ensemble_prediction.py脚本基于上一个训练导出的模型进行集成，其包含两种集成方式：

- 策略1：同源集成 (homogeneous)：加载最佳试验（Best Trial）产生的那 5 个折（Fold）的模型进行投票。

- 策略2：异源集成 (heterogeneous)：加载全局（Global）Top-5 最佳验证准确率的 5 个模型（这 5 个模型可能来自不同的试验）进行投票。

这个脚本会导出（生成）4 个 .txt 预测结果文件，保存在 OUTPUT_DIR（即 .../test_predictions/ 目录）下：

- 同源-精简版 (predictions_homogeneous_5fold.txt)：两列，"测试集名称" 和 "故障类型"。

- 同源-详细版 (predictions_homogeneous_5fold_detailed.txt)：包含每个样本的详细决策过程，如最终预测、置信度（投票比例）、5个模型各自的预测、投票分布等。

- 异源-精简版 (predictions_heterogeneous_top5folds.txt)

- 异源-详细版 (predictions_heterogeneous_top5folds_detailed.txt)

---

## 解决思路

因为optimized_features_dataset.pkl里面包含了划分好的训练集和验证集，所以在进行数据增强的过程中，只读取训练集的频谱和包络特征。在数据增强的过程中，也不需要5折交叉验证，而是在训练集上增强即可。需要进行两个实验：

- 多模态增强：加入归一化缓解模态主导的缺陷，频谱和包络融合后各自再输出两个模态的合成数据

- 各自增强：输入一个模态，增强两次
